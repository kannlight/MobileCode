<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áµ±Âêà„Ç¢„Éó„É™ („Ç≥„Éº„Éâ„Ç®„Éá„Ç£„Çø & SSH„Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        #root {
            height: 100%;
            width: 100%;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568; /* gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* gray-500 */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Lucide„Ç¢„Ç§„Ç≥„É≥„ÅÆÁ∞°ÊòìÁöÑ„Å™‰ª£Êõø
        // CapacitorÁí∞Â¢É„Åß„ÅØÁõ¥Êé•„É≠„Éº„Éâ„Åß„Åç„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„Åü„ÇÅ
        // ÂÆüÈöõ„ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åß„ÅØ„ÄÅ@capacitor/core „ÇÑ @capacitor/browser „Çí‰ΩøÁî®„Åó„Å¶Â§ñÈÉ®„É™„É≥„ÇØ„ÇíÈñã„Åè„Åã„ÄÅ
        // react-icons„ÅÆ„Çà„ÅÜ„Å™„Ç¢„Ç§„Ç≥„É≥„É©„Ç§„Éñ„É©„É™„ÄÅ„Åæ„Åü„ÅØÁõ¥Êé•SVG„Çí‰ΩøÁî®„Åß„Åç„Åæ„Åô„ÄÇ
        const ChevronRight = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>&gt;</span>;
        const MessageSquare = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>üí¨</span>;
        const Edit3 = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>‚úèÔ∏è</span>;
        const CheckSquare = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>‚òëÔ∏è</span>;
        const Square = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>‚¨ú</span>;
        const Save = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>üíæ</span>;
        const Send = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>‚û¢</span>;
        const Bot = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>ü§ñ</span>;
        const User = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>üë§</span>;
        const AlertTriangle = ({ size, className }) => <span className={className} style={{ fontSize: size ? `${size}px` : 'inherit' }}>‚ö†Ô∏è</span>;
        const BACKENDURL  = "http://192.168.11.26:3000"
        // SSH„Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº„Ç¢„Ç§„Ç≥„É≥
        const Server = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
            <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
            <path d="M7 6h.01"></path>
            <path d="M7 18h.01"></path>
          </svg>
        );
        const Folder = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
          </svg>
        );
        const FileText = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <line x1="10" y1="9" x2="8" y2="9"></line>
          </svg>
        );
        const Download = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        );
        const Upload = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
        );
        const ArrowLeft = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
        );
        const Home = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        );
        const RefreshCw = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <path d="M21.5 2v6h-6"></path>
            <path d="M2.5 22v-6h6"></path>
            <path d="M2.5 16a9 9 0 0 1 18.5-4 9 9 0 0 1-2.3 8.3L21.5 22"></path>
            <path d="M21.5 8a9 9 0 0 0-18.5 4 9 9 0 0 0 2.3-8.3L2.5 2"></path>
          </svg>
        );
        const HardDrive = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <line x1="22" y1="12" x2="2" y2="12"></line>
            <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
            <line x1="6" y1="16" x2="6.01" y2="16"></line>
            <line x1="10" y1="16" x2="10.01" y2="16"></line>
          </svg>
        );
        const Terminal = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <polyline points="4 17 10 11 4 5"></polyline>
            <line x1="12" y1="19" x2="20" y2="19"></line>
          </svg>
        );
        const Command = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3z"></path>
            <path d="M6 3a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3 3 3 0 0 1-3-3V6a3 3 0 0 1 3-3z"></path>
            <path d="M12 2v20"></path>
          </svg>
        );
        const Plus = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        );
        const Trash2 = ({ size = 24, className = "" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        );


        const { useState, useEffect, useRef } = React;

        // SSH„Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        const SshFileManager = ({ onBackToMain, connectionInfo, setConnectionInfo }) => {
          // ÁèæÂú®Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÁîªÈù¢„ÇíÁÆ°ÁêÜ: 'connect'ÔºàÊé•Á∂öÁîªÈù¢Ôºâ„ÄÅ'fileManager'ÔºàÊñá‰ª∂ÁÆ°ÁêÜÔºâÔºåÊàñ 'commandExecutor'ÔºàÂëΩ‰ª§ÊâßË°åÂô®Ôºâ
          const [currentSshScreen, setCurrentSshScreen] = useState('connect');
          // Âú®Êñá‰ª∂ÁÆ°ÁêÜÁïåÈù¢ÂÜÖÈÉ®ÔºåÁî®‰∫éÂàáÊç¢Êñá‰ª∂ÂíåÂëΩ‰ª§ËßÜÂõæÁöÑÊ†áÁ≠æÈ°µ
          const [activeTab, setActiveTab] = useState('files'); // 'files' or 'commands'

          // „É™„É¢„Éº„Éà„Éï„Ç°„Ç§„É´„É™„Çπ„Éà„ÅÆÁä∂ÊÖã
          const [remoteFiles, setRemoteFiles] = useState([]);
          // ÁèæÂú®„ÅÆ„É™„É¢„Éº„Éà„Éë„Çπ„ÅÆÁä∂ÊÖã
          const [currentRemotePath, setCurrentRemotePath] = useState('/');
          // „É≠„Éº„ÉâÁä∂ÊÖã
          const [isLoading, setIsLoading] = useState(false);
          // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÁä∂ÊÖã
          const [error, setError] = useState(null);

          // „Ç≥„Éû„É≥„ÉâÂÆüË°åÂô®„ÅÆÁä∂ÊÖã
          const [commandInput, setCommandInput] = useState('');
          const [commandOutput, setCommandOutput] = useState('');
          const [isCommandExecuting, setIsCommandExecuting] = useState(false);
          const [customCommands, setCustomCommands] = useState([]);
          const [newCustomCommandName, setNewCustomCommandName] = useState('');
          const [newCustomCommandValue, setNewCustomCommandValue] = useState('');

          const commandOutputRef = useRef(null);

          // „Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ„Çí„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„É≠„Éº„Éâ
          useEffect(() => {
              try {
                  const storedCommands = localStorage.getItem('customSshCommands');
                  if (storedCommands) {
                      setCustomCommands(JSON.parse(storedCommands));
                  }
              } catch (e) {
                  console.error("„Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ„ÅÆ„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:", e);
              }
          }, []);

          // „Ç≥„Éû„É≥„ÉâÂá∫Âäõ„ÅåÊõ¥Êñ∞„Åï„Çå„Åü„Çâ„Çπ„ÇØ„É≠„Éº„É´
          useEffect(() => {
              if (commandOutputRef.current) {
                  commandOutputRef.current.scrollTop = commandOutputRef.current.scrollHeight;
              }
          }, [commandOutput]);

          // „Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâAPIÂëº„Å≥Âá∫„Åó„ÅÆ„É¢„ÉÉ„ÇØÈñ¢Êï∞
          // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅÂÆüÈöõ„ÅÆ„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éì„Çπ„Å∏„ÅÆfetchÂëº„Å≥Âá∫„Åó„Å´ÁΩÆ„ÅçÊèõ„Åà„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô
          const callBackendApi = async (endpoint, data) => {
            setIsLoading(true);
            setError(null);
            try {
              // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éì„Çπ„ÅåÁâπÂÆö„ÅÆURL„ÅßÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Çã„Å®‰ªÆÂÆö„Åó„Åæ„ÅôÔºà‰æã: http://localhost:3000Ôºâ
              // Capacitor„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅCORS„ÇíË®≠ÂÆö„Åó„ÄÅ„Éá„Éê„Ç§„Çπ„ÅÆÂÆüÈöõ„ÅÆIP„Åæ„Åü„ÅØ„Éâ„É°„Ç§„É≥„Çí‰ΩøÁî®„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô
              const backendUrl = BACKENDURL; // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éì„Çπ„ÅÆURL„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑ
              const response = await fetch(`${backendUrl}${endpoint}`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
              });

              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `API„É™„ÇØ„Ç®„Çπ„ÉàÂ§±Êïó: ${response.status}`);
              }

              const result = await response.json();
              return result;
            } catch (e) {
              console.error('„Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâAPIÂëº„Å≥Âá∫„ÅóÂ§±Êïó:', e);
              setError(e.message || '„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éì„ÇπÊé•Á∂öÂ§±Êïó');
              return null;
            } finally {
              setIsLoading(false);
            }
          };

          // Êé•Á∂ö„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÇíÂá¶ÁêÜ
          const handleConnect = async () => {
            // ÂÖ•ÂäõÊ§úË®º
            if (!connectionInfo.ip || !connectionInfo.username || !connectionInfo.password) {
              setError('„Åô„Åπ„Å¶„ÅÆÊé•Á∂öÊÉÖÂ†±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
              return;
            }

            // „Éê„ÉÉ„ÇØÁ´Ø„Å∏„ÅÆÊé•Á∂ö„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
            const result = await callBackendApi('/connect', connectionInfo);
            if (result && result.success) {
              setCurrentSshScreen('fileManager');
              setCurrentRemotePath('/'); // Êé•Á∂öÊàêÂäüÂæå„ÄÅ„Éá„Éï„Ç©„É´„Éà„Åß„É´„Éº„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíË°®Á§∫
              fetchRemoteFiles('/'); // „Åô„Åê„Å´„É´„Éº„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Éï„Ç°„Ç§„É´„É™„Çπ„Éà„ÇíÂèñÂæó
            } else {
              setError(result?.message || 'Êé•Á∂öÂ§±Êïó„ÄÅË™çË®ºÊÉÖÂ†±„Å®„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
          };

          // „É™„É¢„Éº„Éà„Éï„Ç°„Ç§„É´„É™„Çπ„Éà„ÅÆÂèñÂæó
          const fetchRemoteFiles = async (path) => {
            const result = await callBackendApi('/list', {
              ...connectionInfo, // ÂêÑ„É™„ÇØ„Ç®„Çπ„Éà„ÅßÊé•Á∂öÊÉÖÂ†±„ÇíÈÄÅ‰ø°„Åó„ÄÅ„Éê„ÉÉ„ÇØÁ´Ø„Åå„Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜ„ÇíË°å„ÅÜ
              path: path,
            });
            if (result && result.success) {
              setRemoteFiles(result.files); // „Éê„ÉÉ„ÇØÁ´Ø„Åå { success: true, files: [...] } „ÇíËøî„Åô„Å®‰ªÆÂÆö
              setCurrentRemotePath(path);
            } else {
              setError(result?.message || '„Éï„Ç°„Ç§„É´„É™„Çπ„Éà„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
              setRemoteFiles([]); // „Éï„Ç°„Ç§„É´„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
            }
          };

          // „Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØ„Éï„Ç©„É´„ÉÄ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÇíÂá¶ÁêÜ
          const handleItemClick = (item) => {
            if (item.type === 'directory') {
              const newPath = `${currentRemotePath === '/' ? '' : currentRemotePath}/${item.name}`;
              fetchRemoteFiles(newPath);
            } else {
              // „Éï„Ç°„Ç§„É´„ÅÆÂ†¥Âêà„ÄÅ„Éó„É¨„Éì„É•„Éº„ÇíË°®Á§∫„Åô„Çã„Åã„ÄÅ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Ç™„Éó„Ç∑„Éß„É≥„ÇíÊèê‰æõ
              alert(`„Éï„Ç°„Ç§„É´„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åæ„Åó„Åü: ${item.name}`); // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„Éï„Ç°„Ç§„É´„Éó„É¨„Éì„É•„Éº„Åæ„Åü„ÅØ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„É≠„Ç∏„ÉÉ„ÇØ„Å´ÁΩÆ„ÅçÊèõ„Åà„Çã
              // ‰æã: „Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Çí„Éà„É™„Ç¨„Éº
              // handleDownloadFile(item.name);
            }
          };

          // Ë¶™„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´Êàª„Çã
          const handleGoBack = () => {
            if (currentRemotePath === '/') return;
            const pathParts = currentRemotePath.split('/').filter(part => part !== '');
            pathParts.pop(); // ÊúÄÂæå„ÅÆÈÉ®ÂàÜ„ÇíÂâäÈô§
            const newPath = pathParts.length === 0 ? '/' : `/${pathParts.join('/')}`;
            fetchRemoteFiles(newPath);
          };

          // „É´„Éº„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´Êàª„Çã
          const handleGoHome = () => {
            fetchRemoteFiles('/');
          };

          // ÁèæÂú®„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÊõ¥Êñ∞
          const handleRefresh = () => {
            fetchRemoteFiles(currentRemotePath);
          };

          // „Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ôºà„Éê„ÉÉ„ÇØÁ´Ø„Çµ„Éù„Éº„Éà„ÅåÂøÖË¶ÅÔºâ
          const handleDownloadFile = async (fileName) => {
            const filePath = `${currentRemotePath === '/' ? '' : currentRemotePath}/${fileName}`;
            const result = await callBackendApi('/download', {
              ...connectionInfo,
              path: filePath,
            });
            if (result && result.success && result.fileContent) {
              // „Åì„Åì„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åü„Éï„Ç°„Ç§„É´„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂá¶ÁêÜ„Åó„Åæ„ÅôÔºà‰æã: „Éá„Éê„Ç§„Çπ„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠òÔºâ
              alert(`„Éï„Ç°„Ç§„É´ '${fileName}' „Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü („Ç≥„É≥„ÉÜ„É≥„ÉÑÈï∑: ${result.fileContent.length})`);
              // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅCapacitor Filesystem API „Çí‰ΩøÁî®„Åó„Å¶„Éï„Ç°„Ç§„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åô
              // import { Filesystem, Directory, Encoding } from '@capacitor/filesystem';
              // await Filesystem.writeFile({
              //   path: fileName,
              //   data: result.fileContent,
              //   directory: Directory.Documents,
              //   encoding: Encoding.UTF8, // „Åæ„Åü„ÅØÈÅ©Âàá„Å™„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞
              // });
            } else {
              setError(result?.message || '„Éï„Ç°„Ç§„É´„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
            }
          };

          // „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ôºà„Éê„ÉÉ„ÇØÁ´Ø„Çµ„Éù„Éº„Éà„ÅåÂøÖË¶ÅÔºâ
          const handleUploadFile = async () => {
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅ<input type="file"> „Åæ„Åü„ÅØ Capacitor FilePicker API „Çí‰ΩøÁî®„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Åæ„Åô
            // „Åì„Çå„ÅØ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Åß„Åô
            alert('„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ©üËÉΩ„ÅØÊú™ÂÆüË£Ö„Åß„Åô„ÄÇ„É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Éê„ÉÉ„ÇØÁ´Ø„Å´ÈÄÅ‰ø°„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ');
            // ‰æã:
            // const fileContent = "„Åì„Çå„ÅØ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Çµ„É≥„Éó„É´„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åß„Åô„ÄÇ";
            // const result = await callBackendApi('/upload', {
            //   ...connectionInfo,
            //   path: `${currentRemotePath}/new_uploaded_file.txt`,
            //   content: fileContent,
            // });
            // if (result && result.success) {
            //   alert('„Éï„Ç°„Ç§„É´„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´ÊàêÂäü„Åó„Åæ„Åó„ÅüÔºÅ');
            //   fetchRemoteFiles(currentRemotePath); // „É™„Çπ„Éà„ÇíÊõ¥Êñ∞
            // } else {
            //   setError(result?.message || '„Éï„Ç°„Ç§„É´„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
            // }
          };

          // „Ç≥„Éû„É≥„ÉâÂÆüË°åÂô®„ÅÆAPIÂëº„Å≥Âá∫„Åó
          const executeRemoteCommand = async (command) => {
            if (!connectionInfo.ip || !connectionInfo.username || !connectionInfo.password) {
              setCommandOutput(prev => prev + '\n„Ç®„É©„Éº: SSHÊé•Á∂öÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº„ÅßÊé•Á∂ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n');
              return;
            }
            setIsCommandExecuting(true);
            setCommandOutput(prev => prev + `\n> ${command}\n`); // ÂÖ•Âäõ„Ç≥„Éû„É≥„Éâ„ÇíË°®Á§∫
            try {
                const backendUrl = BACKENDURL; // „Éê„ÉÉ„ÇØÁ´Ø„Çµ„Éº„Éì„Çπ„ÅÆURL„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑ
                const response = await fetch(`${backendUrl}/execute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ...connectionInfo,
                        command: command,
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `API„É™„ÇØ„Ç®„Çπ„ÉàÂ§±Êïó: ${response.status}`);
                }

                const result = await response.json();
                setCommandOutput(prev => prev + (result.output || '') + '\n'); // Âá∫Âäõ„ÇíËøΩÂä†
                if (result.error) {
                    setCommandOutput(prev => prev + `„Ç®„É©„Éº: ${result.error}\n`);
                }
            } catch (e) {
                console.error('„Ç≥„Éû„É≥„ÉâÂÆüË°åÂ§±Êïó:', e);
                setCommandOutput(prev => prev + `\n„Ç®„É©„Éº: ${e.message || '„Ç≥„Éû„É≥„ÉâÂÆüË°å‰∏≠„Å´‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ'}\n`);
            } finally {
                setIsCommandExecuting(false);
            }
          };

          // „Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ„ÅÆËøΩÂä†
          const handleAddCustomCommand = () => {
              if (newCustomCommandName.trim() && newCustomCommandValue.trim()) {
                  const newCommands = [...customCommands, { name: newCustomCommandName.trim(), command: newCustomCommandValue.trim() }];
                  setCustomCommands(newCommands);
                  localStorage.setItem('customSshCommands', JSON.stringify(newCommands));
                  setNewCustomCommandName('');
                  setNewCustomCommandValue('');
              } else {
                  alert('„Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ„ÅÆÂêçÂâç„Å®„Ç≥„Éû„É≥„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
              }
          };

          // „Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ„ÅÆÂâäÈô§
          const handleDeleteCustomCommand = (indexToDelete) => {
              const updatedCommands = customCommands.filter((_, index) => index !== indexToDelete);
              setCustomCommands(updatedCommands);
              localStorage.setItem('customSshCommands', JSON.stringify(updatedCommands));
          };


          // Ê∏≤ÊüìËøûÊé•ÁïåÈù¢
          const renderConnectScreen = () => (
            <div className="min-h-screen flex items-center justify-center bg-gray-900 p-4">
              <div className="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-gray-700">
                <h2 className="text-3xl font-bold text-white mb-6 text-center flex items-center justify-center">
                  <Server size={32} className="mr-3 text-blue-400" /> „É™„É¢„Éº„Éà„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö
                </h2>
                {error && (
                  <div className="bg-red-700/30 text-red-300 p-3 rounded-lg mb-4 text-sm text-center border border-red-600">
                    {error}
                  </div>
                )}
                <div className="space-y-4">
                  <div>
                    <label htmlFor="ip" className="block text-gray-300 text-sm font-medium mb-1">IP„Ç¢„Éâ„É¨„Çπ / „Éõ„Çπ„ÉàÂêç</label>
                    <input
                      type="text"
                      id="ip"
                      className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                      value={connectionInfo.ip}
                      onChange={(e) => setConnectionInfo({ ...connectionInfo, ip: e.target.value })}
                      placeholder="‰æã: 192.168.1.1 „Åæ„Åü„ÅØ example.com"
                    />
                  </div>
                  <div>
                    <label htmlFor="port" className="block text-gray-300 text-sm font-medium mb-1">„Éù„Éº„Éà</label>
                    <input
                      type="number"
                      id="port"
                      className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                      value={connectionInfo.port}
                      onChange={(e) => setConnectionInfo({ ...connectionInfo, port: e.target.value })}
                      placeholder="„Éá„Éï„Ç©„É´„Éà: 22"
                    />
                  </div>
                  <div>
                    <label htmlFor="username" className="block text-gray-300 text-sm font-medium mb-1">„É¶„Éº„Ç∂„ÉºÂêç</label>
                    <input
                      type="text"
                      id="username"
                      className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                      value={connectionInfo.username}
                      onChange={(e) => setConnectionInfo({ ...connectionInfo, username: e.target.value })}
                      placeholder="‰æã: root „Åæ„Åü„ÅØ ubuntu"
                    />
                  </div>
                  <div>
                    <label htmlFor="password" className="block text-gray-300 text-sm font-medium mb-1">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input
                      type="password"
                      id="password"
                      className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                      value={connectionInfo.password}
                      onChange={(e) => setConnectionInfo({ ...connectionInfo, password: e.target.value })}
                      placeholder="SSH„Éë„Çπ„ÉØ„Éº„Éâ"
                    />
                  </div>
                  <button
                    onClick={handleConnect}
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg shadow-lg transition duration-200 ease-in-out flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled={isLoading}
                  >
                    {isLoading ? (
                      <svg className="animate-spin h-5 w-5 text-white mr-3" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                    ) : (
                      <Server size={20} className="mr-2" />
                    )}
                    {isLoading ? 'Êé•Á∂ö‰∏≠...' : 'Êé•Á∂ö'}
                  </button>
                </div>
              </div>
            </div>
          );

          // Êñá‰ª∂ÁÆ°ÁêÜÁîªÈù¢„Å®„Ç≥„Éû„É≥„ÉâÂÆüË°åÂô®„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞ (Áµ±Âêà)
          const renderFileManagerAndCommandExecutorScreen = () => (
            <div className="flex flex-col h-full bg-gray-900 text-white">
              <header className="bg-gray-800 p-4 shadow-md flex items-center justify-between">
                <div className="flex items-center">
                  <Folder size={28} className="mr-3 text-yellow-400" />
                  <h1 className="text-xl font-semibold">„É™„É¢„Éº„Éà„Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº</h1>
                </div>
                <div className="flex items-center space-x-2">
                  {/* ËøîÂõû‰∏ªÁïåÈù¢ÁöÑÊåâÈíÆ */}
                  <button
                    onClick={onBackToMain}
                    className="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out"
                  >
                    Êàª„Çã
                  </button>
                  <button
                    onClick={() => {
                      setCurrentSshScreen('connect');
                      setConnectionInfo({ ip: '', port: '22', username: '', password: '' }); // ÂàáÊñ≠Êó∂Ê∏ÖÈô§ËøûÊé•‰ø°ÊÅØ
                    }}
                    className="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out"
                  >
                    ÂàáÊñ≠
                  </button>
                </div>
              </header>

              {/* Ê†áÁ≠æÈ°µÂØºËà™ */}
              <div className="flex bg-gray-800 border-b border-gray-700">
                <button
                  onClick={() => setActiveTab('files')}
                  className={`flex-1 py-3 text-center font-semibold transition duration-150 ease-in-out ${
                    activeTab === 'files' ? 'bg-gray-700 text-white border-b-2 border-blue-500' : 'text-gray-400 hover:bg-gray-700/50'
                  }`}
                >
                  <FileText size={20} className="inline-block mr-2" /> „Éï„Ç°„Ç§„É´
                </button>
                <button
                  onClick={() => setActiveTab('commands')}
                  className={`flex-1 py-3 text-center font-semibold transition duration-150 ease-in-out ${
                    activeTab === 'commands' ? 'bg-gray-700 text-white border-b-2 border-blue-500' : 'text-gray-400 hover:bg-gray-700/50'
                  }`}
                >
                  <Terminal size={20} className="inline-block mr-2" /> „Ç≥„Éû„É≥„Éâ
                </button>
              </div>

              {/* Êñá‰ª∂ÁÆ°ÁêÜÂÜÖÂÆπ */}
              {activeTab === 'files' && (
                <>
                  <div className="p-4 bg-gray-800 border-b border-gray-700 flex items-center space-x-2">
                    <button
                      onClick={handleGoBack}
                      disabled={currentRemotePath === '/' || isLoading}
                      className="bg-gray-700 hover:bg-gray-600 text-white font-semibold p-2 rounded-lg shadow transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"
                      title="‰∏Ä„Å§‰∏ä„ÅÆÈöéÂ±§„Å∏"
                    >
                      <ArrowLeft size={20} />
                    </button>
                    <button
                      onClick={handleGoHome}
                      disabled={currentRemotePath === '/' || isLoading}
                      className="bg-gray-700 hover:bg-gray-600 text-white font-semibold p-2 rounded-lg shadow transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"
                      title="„É´„Éº„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„Å∏"
                    >
                      <Home size={20} />
                    </button>
                    <button
                      onClick={handleRefresh}
                      disabled={isLoading}
                      className="bg-gray-700 hover:bg-gray-600 text-white font-semibold p-2 rounded-lg shadow transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"
                      title="Êõ¥Êñ∞"
                    >
                      <RefreshCw size={20} />
                    </button>
                    <span className="flex-grow text-gray-300 text-sm truncate ml-2">
                      ÁèæÂú®„ÅÆ„Éë„Çπ: {currentRemotePath}
                    </span>
                  </div>

                  {error && (
                    <div className="bg-red-700/30 text-red-300 p-3 rounded-lg m-4 text-sm text-center border border-red-600">
                      {error}
                    </div>
                  )}

                  <div className="flex-grow overflow-y-auto p-4 space-y-2">
                    {isLoading ? (
                      <div className="flex justify-center items-center h-full">
                        <svg className="animate-spin h-8 w-8 text-blue-400" viewBox="0 0 24 24">
                          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p className="ml-3 text-gray-400">„É≠„Éº„Éâ‰∏≠...</p>
                      </div>
                    ) : remoteFiles.length === 0 ? (
                      <div className="text-center text-gray-500 mt-10">
                        <p className="text-lg">„Åì„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅØÁ©∫„Åß„Åô„ÄÇ</p>
                      </div>
                    ) : (
                      remoteFiles.map((item, index) => (
                        <div
                          key={index}
                          className="flex items-center bg-gray-800 p-3 rounded-lg shadow-md hover:bg-gray-700 transition duration-150 ease-in-out cursor-pointer"
                          onClick={() => handleItemClick(item)}
                        >
                          {item.type === 'directory' ? (
                            <Folder size={24} className="text-blue-400 mr-3" />
                          ) : (
                            <FileText size={24} className="text-green-400 mr-3" />
                          )}
                          <span className="flex-grow text-gray-100 font-medium truncate">{item.name}</span>
                          {item.type === 'file' && (
                            <button
                              onClick={(e) => { e.stopPropagation(); handleDownloadFile(item.name); }}
                              className="ml-4 bg-purple-600 hover:bg-purple-700 text-white text-sm px-3 py-1 rounded-md shadow transition duration-150 ease-in-out flex items-center"
                            >
                              <Download size={16} className="mr-1" /> „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                            </button>
                          )}
                        </div>
                      ))
                    )}
                  </div>

                  <footer className="bg-gray-800 p-4 border-t border-gray-700 flex justify-end space-x-3">
                    <button
                      onClick={handleUploadFile}
                      className="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out flex items-center disabled:opacity-50 disabled:cursor-not-allowed"
                      disabled={isLoading}
                    >
                      <Upload size={18} className="mr-2" /> „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                    </button>
                  </footer>
                </>
              )}

              {/* ÂëΩ‰ª§ÊâßË°åÂô®ÂÜÖÂÆπ */}
              {activeTab === 'commands' && (
                <div className="flex flex-col flex-grow p-4 overflow-auto">
                  <h2 className="text-lg font-semibold text-gray-200 mb-3 flex items-center">
                    <Terminal size={20} className="mr-2 text-teal-400" /> „Ç≥„Éû„É≥„ÉâÂÆüË°åÂô®
                  </h2>
                  <pre ref={commandOutputRef} className="bg-gray-900 text-green-300 p-4 rounded-lg shadow-inner overflow-auto h-48 font-mono text-sm mb-4">
                    {commandOutput || '„Åì„Åì„Å´„Ç≥„Éû„É≥„ÉâÂá∫Âäõ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô...'}
                  </pre>

                  <div className="mb-4">
                    <h3 className="text-md font-semibold text-gray-200 mb-2">„Ç≥„Éû„É≥„ÉâÂÆüË°å</h3>
                    <div className="flex space-x-2">
                      <input
                        type="text"
                        value={commandInput}
                        onChange={(e) => setCommandInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && !isCommandExecuting && executeRemoteCommand(commandInput)}
                        placeholder="ÂÆüË°å„Åô„Çã„Ç≥„Éû„É≥„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ (‰æã: ls -la /var/log)"
                        className="flex-grow p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-2 focus:ring-teal-500 focus:outline-none shadow-inner"
                        disabled={isCommandExecuting || !connectionInfo.ip}
                      />
                      <button
                        onClick={() => executeRemoteCommand(commandInput)}
                        className="bg-teal-600 hover:bg-teal-700 text-white font-semibold p-3 rounded-lg shadow transition duration-150 ease-in-out flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled={isCommandExecuting || !commandInput.trim() || !connectionInfo.ip}
                      >
                        {isCommandExecuting ? (
                          <svg className="animate-spin h-5 w-5 text-white mr-2" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                        ) : (
                          <Command size={20} className="mr-1" />
                        )}
                        ÂÆüË°å
                      </button>
                    </div>
                  </div>

                  <div>
                    <h3 className="text-md font-semibold text-gray-200 mb-2">„Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ</h3>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-4">
                      {customCommands.map((cmd, index) => (
                        <div key={index} className="flex items-center bg-gray-900 p-2 rounded-lg shadow justify-between">
                          <button
                            onClick={() => setCommandInput(cmd.command)}
                            className="flex-grow text-left text-blue-400 hover:text-blue-300 transition duration-150 ease-in-out truncate"
                            title={cmd.command}
                          >
                            {cmd.name}
                          </button>
                          <button
                            onClick={() => handleDeleteCustomCommand(index)}
                            className="ml-2 text-red-400 hover:text-red-500 transition duration-150 ease-in-out"
                            title="ÂâäÈô§"
                          >
                            <Trash2 size={18} />
                          </button>
                        </div>
                      ))}
                    </div>
                    <div className="bg-gray-900 p-4 rounded-lg shadow">
                      <h3 className="text-md font-semibold text-gray-200 mb-3">Êñ∞„Åó„ÅÑ„Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ„ÇíËøΩÂä†</h3>
                      <div className="space-y-3">
                        <div>
                          <label htmlFor="newCommandName" className="block text-gray-300 text-sm font-medium mb-1">ÂêçÂâç</label>
                          <input
                            type="text"
                            id="newCommandName"
                            value={newCustomCommandName}
                            onChange={(e) => setNewCustomCommandName(e.target.value)}
                            placeholder="‰æã: „Éá„Ç£„Çπ„ÇØ‰ΩøÁî®Èáè"
                            className="w-full p-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-teal-500 focus:border-teal-500"
                          />
                        </div>
                        <div>
                          <label htmlFor="newCommandValue" className="block text-gray-300 text-sm font-medium mb-1">„Ç≥„Éû„É≥„Éâ</label>
                          <input
                            type="text"
                            id="newCommandValue"
                            value={newCustomCommandValue}
                            onChange={(e) => setNewCustomCommandValue(e.target.value)}
                            placeholder="‰æã: df -h"
                            className="w-full p-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-teal-500 focus:border-teal-500"
                          />
                        </div>
                        <button
                          onClick={handleAddCustomCommand}
                          className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-lg shadow transition duration-150 ease-in-out flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                          disabled={!newCustomCommandName.trim() || !newCustomCommandValue.trim()}
                        >
                          <Plus size={18} className="mr-1.5" /> „Ç´„Çπ„Çø„É†„Ç≥„Éû„É≥„Éâ„ÇíËøΩÂä†
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );

          return (
            <div className="h-full">
              {currentSshScreen === 'connect' ? renderConnectScreen() : renderFileManagerAndCommandExecutorScreen()}
            </div>
          );
        };


        // „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        const App = () => {
          // ÁèæÂú®Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„É°„Ç§„É≥ÁîªÈù¢„ÇíÁÆ°ÁêÜ: 'chat'Ôºà„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢Ôºâ„ÄÅ'editor'Ôºà„Ç≥„Éº„Éâ„Ç®„Éá„Ç£„ÇøÔºâ„ÄÅ„Åæ„Åü„ÅØ 'sshFileManager'ÔºàSSH„Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº„Å®„Ç≥„Éû„É≥„ÉâÂÆüË°åÂô®Ôºâ
          const [mainScreen, setMainScreen] = useState('chat');
          const [chatMessages, setChatMessages] = useState([
            { sender: 'gemini', text: '„Åì„Çì„Å´„Å°„ÅØÔºÅ„Å©„ÅÆ„Çà„ÅÜ„Å™„Ç≥„Éº„Éâ„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÅãÔºü„Åæ„Åü„ÅØ„ÄÅÊó¢Â≠ò„ÅÆ„Ç≥„Éº„Éâ„ÇíÁ∑®ÈõÜ„Åó„Åæ„Åô„ÅãÔºü', isCodeSuggestion: false }
          ]);
          const [code, setCode] = useState('');
          const [selectedLines, setSelectedLines] = useState([]);
          const [userInput, setUserInput] = useState('');
          const [editingContext, setEditingContext] = useState(null);
          const [isLoading, setIsLoading] = useState(false);
          const [error, setError] = useState(null);

          const chatEndRef = useRef(null);

          // Êé•Á∂öÊÉÖÂ†±ÔºàSSH„Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº„Å®ÂÖ±ÊúâÔºâ
          const [connectionInfo, setConnectionInfo] = useState({
            ip: '',
            port: '22',
            username: '',
            password: '',
          });

          useEffect(() => {
            if (chatEndRef.current) {
              chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
            }
          }, [chatMessages]);

          const transformChatMessagesForApi = (messages) => {
            return messages
              .filter(msg => msg.sender === 'user' || msg.sender === 'gemini')
              .map(msg => ({
                role: msg.sender === 'user' ? 'user' : 'model',
                parts: [{ text: msg.text }],
              }));
          };

          const callGeminiApi = async (userPrompt, currentChatHistory, currentFullCode, linesToEditInfo) => {
            setIsLoading(true);
            setError(null);
            // !!! IMPORTANT: REPLACE "" WITH YOUR ACTUAL GEMINI API KEY !!!
            const apiKey = typeof GEMINI_API_KEY !== 'undefined' ? GEMINI_API_KEY : "AIzaSyDj1ncDGK-Pnx38Vbv_fqa0U2wc8S04QA8";

            if (!apiKey) {
                setError("Gemini API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇHTML„Éï„Ç°„Ç§„É´ÂÜÖ„ÅÆ`apiKey`Â§âÊï∞„ÇíÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
                setIsLoading(false);
                return null;
            }

            let systemInstruction = `„ÅÇ„Å™„Åü„ÅØÂÑ™ÁßÄ„Å™AI„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Åß„Åô„ÄÇ„É¶„Éº„Ç∂„Éº„ÅÆÊåáÁ§∫„Å´Âü∫„Å•„ÅÑ„Å¶„Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„Éà„ÇíÁîüÊàê„Åæ„Åü„ÅØÂ§âÊõ¥„Åó„Åæ„Åô„ÄÇ
ÁîüÊàê„Åô„Çã„Ç≥„Éº„Éâ„ÅØ„ÄÅÁ∞°ÊΩî„Åß„ÄÅ„É¶„Éº„Ç∂„Éº„ÅÆË¶ÅÊ±Ç„Å´Áõ¥Êé•Âøú„Åà„Çã„ÇÇ„ÅÆ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
Ëá™Ë∫´„ÅÆËß£Ë™¨„ÇÑ„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºà‰æã: \`\`\`Ôºâ„ÇíÂê´„ÇÅ„Åö„ÄÅË¶ÅÊ±Ç„Åï„Çå„Åü„Ç≥„Éº„Éâ„Åù„ÅÆ„ÇÇ„ÅÆ„Å†„Åë„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

            let constructedPrompt = userPrompt;

            if (linesToEditInfo && linesToEditInfo.lines.length > 0) {
              systemInstruction = `„ÅÇ„Å™„Åü„ÅØÂÑ™ÁßÄ„Å™AI„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Åß„Åô„ÄÇ„É¶„Éº„Ç∂„Éº„ÅØÊó¢Â≠ò„ÅÆ„Ç≥„Éº„Éâ„ÅÆÁâπÂÆöÈÉ®ÂàÜ„ÅÆÁ∑®ÈõÜ„ÇíÊåáÁ§∫„Åó„Åæ„Åô„ÄÇ
ÁèæÂú®„ÅÆ„Ç≥„Éº„ÉâÂÖ®‰Ωì„Å®Á∑®ÈõÜÊåáÁ§∫„ÄÅÊ≥®ÁõÆ„Åô„Åπ„ÅçË°åÁï™Âè∑„ÇíÊèêÁ§∫„Åó„Åæ„Åô„ÄÇ
„Åì„Çå„Çâ„ÇíËÄÉÊÖÆ„Åó„ÄÅÊåáÁ§∫„ÇíÂèçÊò†„Åó„Åü‰∏ä„Åß„ÄÅ‰øÆÊ≠£Âæå„ÅÆÂÆåÂÖ®„Å™„Ç≥„Éº„ÉâÂÖ®‰Ωì„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
„ÅÇ„Å™„Åü„ÅÆËß£Ë™¨„ÇÑËøΩÂä†„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÄÅ„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºà‰æã: \`\`\`Ôºâ„ÅØ‰∏ÄÂàá‰∏çË¶Å„Åß„Åô„ÄÇÂøÖ„Åö„Ç≥„Éº„ÉâÂÖ®‰Ωì„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
              
              constructedPrompt = `„É¶„Éº„Ç∂„Éº„ÅØ„ÄÅÁèæÂú®„Ç®„Éá„Ç£„Çø„Å´„ÅÇ„Çã‰ª•‰∏ã„ÅÆ„Ç≥„Éº„ÉâÂÖ®‰Ωì„Å´„Å§„ÅÑ„Å¶„ÄÅÁâπ„Å´Ôºà${linesToEditInfo.lines.join(', ')}Ë°åÁõÆ ‰ªòËøëÔºâ„Å´ÂØæ„Åô„ÇãÁ∑®ÈõÜ„ÇíÂ∏åÊúõ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n\nÁ∑®ÈõÜÊåáÁ§∫„ÅØ„Äå${userPrompt}„Äç„Åß„Åô„ÄÇ\n\nÁèæÂú®„ÅÆ„Ç≥„Éº„ÉâÂÖ®‰Ωì„ÅØÊ¨°„ÅÆ„Å®„Åä„Çä„Åß„Åô:\n\`\`\`\n${currentFullCode}\n\`\`\`\n\n„Åì„ÅÆÁ∑®ÈõÜÊåáÁ§∫„ÇíËÄÉÊÖÆ„Åó„ÄÅ‰∏äË®ò„ÅÆ„Ç≥„Éº„ÉâÂÖ®‰Ωì„Çí‰øÆÊ≠£„Åó„ÅüÊúÄÁµÇÁöÑ„Å™ÂÆåÂÖ®„Å™„Ç≥„Éº„Éâ„ÅÆ„Åø„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
            } else {
              constructedPrompt = `‰ª•‰∏ã„ÅÆÊåáÁ§∫„Å´Âü∫„Å•„ÅÑ„Å¶„Ç≥„Éº„Éâ„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ: „Äå${userPrompt}„Äç\nÁîüÊàê„Åï„Çå„Åü„Ç≥„Éº„Éâ„Åù„ÅÆ„ÇÇ„ÅÆ„Å†„Åë„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
            }


            const apiChatHistory = transformChatMessagesForApi(currentChatHistory);

            const payload = {
              contents: [
                { role: "user", parts: [{ text: `System Instruction: ${systemInstruction}` }] },
                { role: "model", parts: [{ text: "„ÅØ„ÅÑ„ÄÅÊâøÁü•„ÅÑ„Åü„Åó„Åæ„Åó„Åü„ÄÇÊåáÁ§∫„Å´Âæì„ÅÑ„Ç≥„Éº„Éâ„ÇíËøî„Åó„Åæ„Åô„ÄÇ" }] },
                ...apiChatHistory,
                { role: "user", parts: [{ text: constructedPrompt }] }
              ],
            };

            try {
              const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
              });

              if (!response.ok) {
                const errorData = await response.json();
                console.error('Gemini API Error:', errorData);
                throw new Error(`API„Ç®„É©„Éº: ${errorData.error?.message || response.statusText} („Çπ„ÉÜ„Éº„Çø„Çπ: ${response.status})`);
              }

              const result = await response.json();

              if (result.candidates && result.candidates.length > 0 &&
                  result.candidates[0].content && result.candidates[0].content.parts &&
                  result.candidates[0].content.parts.length > 0) {
                let generatedText = result.candidates[0].content.parts[0].text;
                generatedText = generatedText.replace(/^```[\w]*\n?/gm, '').replace(/```$/gm, '').trim();
                return generatedText;
              } else {
                console.error('Gemini API Response format unexpected:', result);
                throw new Error('Gemini„Åã„Çâ„ÅÆÂøúÁ≠î„Åå‰∫àÊúü„Åó„ÅüÂΩ¢Âºè„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ');
              }
            } catch (e) {
              console.error('Gemini API Call failed:', e);
              setError(e.message || 'Gemini API„ÅÆÂëº„Å≥Âá∫„Åó‰∏≠„Å´‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ');
              return null;
            } finally {
              setIsLoading(false);
            }
          };

          const handleSendMessage = async () => {
            if (!userInput.trim()) return;

            const newUserMessage = { sender: 'user', text: userInput };
            const currentMessagesForApi = [...chatMessages, newUserMessage];
            setChatMessages(currentMessagesForApi);


            const currentEditingContext = editingContext;
            const currentCodeForApi = code;
            setUserInput('');

            const geminiResponseText = await callGeminiApi(newUserMessage.text, currentMessagesForApi, currentCodeForApi, currentEditingContext);

            if (geminiResponseText !== null) {
              const newGeminiMessage = {
                sender: 'gemini',
                text: geminiResponseText,
                isCodeSuggestion: true,
                editingContextSnapshot: currentEditingContext ? { ...currentEditingContext } : null,
              };
              setChatMessages(prev => [...prev, newGeminiMessage]);
            }
          };

          const handleApplyCode = (rawGeminiResponse, messageEditingContextSnapshot) => {
            setError(null);
            setCode(rawGeminiResponse); 

            if (messageEditingContextSnapshot && messageEditingContextSnapshot.lines.length > 0) {
                setChatMessages(prev => [...prev, {sender: 'system', text: `Á∑®ÈõÜÊåáÁ§∫„Å´Âü∫„Å•„ÅÑ„Å¶„ÄÅ„Ç≥„Éº„ÉâÂÖ®‰Ωì„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü„ÄÇ(Ê≥®ÁõÆË°å: ${messageEditingContextSnapshot.lines.join(', ')})`}]);
            } else {
                setChatMessages(prev => [...prev, {sender: 'system', text: 'Êñ∞„Åó„ÅÑ„Ç≥„Éº„Éâ„Åå„Ç®„Éá„Ç£„Çø„Å´ÂèçÊò†„Åï„Çå„Åæ„Åó„Åü„ÄÇ'}]);
            }
            
            setEditingContext(null); 
            setMainScreen('editor'); // „Ç®„Éá„Ç£„ÇøÁîªÈù¢„Å´Âàá„ÇäÊõø„Åà„Çã
            setSelectedLines([]);
          };

          const handleEditSelectedLines = () => {
            if (selectedLines.length === 0) {
              setChatMessages(prev => [...prev, {sender: 'system', text: 'Á∑®ÈõÜ„Åô„ÇãË°å„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'}]);
              return;
            }
            const sortedSelectedLines = [...selectedLines].sort((a, b) => a - b);
            setEditingContext({ lines: sortedSelectedLines });
            setMainScreen('chat'); // „ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„Å´Âàá„ÇäÊõø„Åà„Çã
            setUserInput(''); 
            setChatMessages(prev => [
                ...prev,
                {sender: 'system', text: `Á¨¨${sortedSelectedLines.join(', ')}Ë°å‰ªòËøë„ÅÆÁ∑®ÈõÜÂÜÖÂÆπ„ÇíÊåáÁ§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇGemini„Åå„Ç≥„Éº„ÉâÂÖ®‰Ωì„Çí‰øÆÊ≠£„Åó„Åæ„Åô„ÄÇ`}
            ]);
            setError(null);
          };

          const toggleLineSelection = (lineNumber) => {
            setSelectedLines(prev =>
              prev.includes(lineNumber)
                ? prev.filter(ln => ln !== lineNumber)
                : [...prev, lineNumber]
            );
          };


          // „ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
          const renderChatScreen = () => (
            <div className="flex flex-col h-full bg-gray-800 text-white">
              <header className="p-4 bg-gray-900 shadow-md flex items-center justify-between">
                <div className="flex items-center">
                  <Bot size={28} className="mr-2 text-blue-400" />
                  <h1 className="text-xl font-semibold">Gemini„ÉÅ„É£„ÉÉ„Éà</h1>
                </div>
                <div className="flex items-center space-x-3">
                    <button
                      onClick={() => setMainScreen('editor')}
                      className="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out flex items-center"
                      disabled={!code && mainScreen === 'chat'}
                      title={!code && mainScreen === 'chat' ? "ÂèçÊò†„Åô„Çã„Ç≥„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì" : "„Ç®„Éá„Ç£„Çø„Å´Âàá„ÇäÊõø„Åà„Çã"}
                    >
                      „Ç®„Éá„Ç£„Çø <ChevronRight size={20} className="ml-1" />
                    </button>
                    <button
                      onClick={() => setMainScreen('sshFileManager')}
                      className="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out flex items-center"
                    >
                      <HardDrive size={20} className="mr-1.5" /> „Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº
                    </button>
                </div>
              </header>
              <div className="flex-grow p-4 overflow-y-auto space-y-4 bg-gray-700/50">
                {error && (
                    <div className="my-2 p-3 bg-red-800/80 text-white rounded-lg shadow flex items-center">
                        <AlertTriangle size={20} className="mr-2 text-red-300" />
                        <div>
                            <p className="font-semibold">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:</p>
                            <p className="text-sm">{error}</p>
                        </div>
                    </div>
                )}
                {chatMessages.map((msg, index) => (
                  <div key={index} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`max-w-2xl p-3 rounded-xl shadow-lg ${
                      msg.sender === 'user' ? 'bg-blue-600 text-white rounded-br-none' :
                      msg.sender === 'gemini' ? 'bg-gray-600 text-gray-100 rounded-bl-none' :
                      'bg-yellow-600/30 text-yellow-100 text-sm italic text-center w-full py-2 rounded-md'
                    }`}>
                      {msg.sender === 'gemini' && !msg.isCodeSuggestion && <Bot size={18} className="inline mr-2 mb-1 text-blue-300" />}
                      {msg.sender === 'gemini' && msg.isCodeSuggestion && <Bot size={18} className="inline mr-2 mb-1 text-green-400" />}
                      {msg.sender === 'user' && <User size={18} className="inline mr-2 mb-1 text-blue-300" />}
                      {typeof msg.text === 'string' && msg.text.split('\n').map((line, i) => (
                        <span key={i} className="block whitespace-pre-wrap">{line}</span>
                      ))}
                      {msg.isCodeSuggestion && msg.sender === 'gemini' && msg.text && (
                        <button
                          onClick={() => handleApplyCode(msg.text, msg.editingContextSnapshot)}
                          className="mt-3 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 rounded-lg shadow-md transition duration-150 ease-in-out text-sm flex items-center"
                        >
                          <CheckSquare size={16} className="mr-1.5" /> „Ç≥„Éº„Éâ„ÇíÈÅ©Áî®
                        </button>
                      )}
                    </div>
                  </div>
                ))}
                {isLoading && (
                    <div className="flex justify-center items-center p-4">
                        <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-400"></div>
                        <p className="ml-3 text-gray-300">Gemini„ÅåËÄÉ„Åà‰∏≠...</p>
                    </div>
                )}
                <div ref={chatEndRef} />
              </div>
              <div className="p-4 bg-gray-900 border-t border-gray-700">
                <div className="flex items-center space-x-2">
                  <input
                    type="text"
                    value={userInput}
                    onChange={(e) => setUserInput(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && !isLoading && handleSendMessage()}
                    placeholder={editingContext ? `Á¨¨${editingContext.lines.join(', ')}Ë°å‰ªòËøë„ÅÆÁ∑®ÈõÜÂÜÖÂÆπ... („Ç≥„Éº„ÉâÂÖ®‰Ωì„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åô)` : "Gemini„Å´„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°..."}
                    className="flex-grow p-3 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none shadow-inner"
                    disabled={isLoading}
                  />
                  <button
                    onClick={handleSendMessage}
                    className="bg-blue-500 hover:bg-blue-600 text-white font-semibold p-3 rounded-lg shadow transition duration-150 ease-in-out flex items-center justify-center"
                    disabled={isLoading || !userInput.trim()}
                  >
                    <Send size={20} />
                  </button>
                </div>
              </div>
            </div>
          );

          // „Ç®„Éá„Ç£„ÇøÁîªÈù¢„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
          const renderEditorScreen = () => (
            <div className="flex flex-col h-full bg-gray-800 text-white">
              <header className="p-4 bg-gray-900 shadow-md flex items-center justify-between">
                <div className="flex items-center">
                  <Edit3 size={28} className="mr-2 text-green-400" />
                  <h1 className="text-xl font-semibold">„Ç≥„Éº„Éâ„Ç®„Éá„Ç£„Çø</h1>
                </div>
                <div className="flex items-center space-x-3">
                   <button
                    onClick={() => {
                        setMainScreen('chat');
                        setError(null);
                    }}
                    className="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out flex items-center"
                  >
                    <MessageSquare size={20} className="mr-1.5" /> „ÉÅ„É£„ÉÉ„Éà
                  </button>
                  <button
                    onClick={() => setMainScreen('sshFileManager')}
                    className="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out flex items-center"
                  >
                    <HardDrive size={20} className="mr-1.5" /> „Éï„Ç°„Ç§„É´„Éû„Éç„Éº„Ç∏„É£„Éº
                  </button>
                  <button
                    onClick={handleEditSelectedLines}
                    disabled={selectedLines.length === 0}
                    className={`font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out flex items-center ${
                      selectedLines.length > 0 ? 'bg-yellow-500 hover:bg-yellow-600 text-black' : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                    }`}
                    title={selectedLines.length === 0 ? "Á∑®ÈõÜ„Åô„ÇãË°å„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ" : "ÈÅ∏ÊäûË°å„ÇíÁ∑®ÈõÜ"}
                  >
                    <Edit3 size={20} className="mr-1.5" /> ÈÅ∏ÊäûË°å„ÇíÁ∑®ÈõÜ
                  </button>
                </div>
              </header>
              <div className="flex-grow p-4 overflow-auto bg-gray-700/50">
                {error && (
                     <div className="mb-4 p-3 bg-red-800/80 text-white rounded-lg shadow flex items-center">
                        <AlertTriangle size={20} className="mr-2 text-red-300" />
                        <div>
                            <p className="font-semibold">„Ç®„É©„Éº:</p>
                            <p className="text-sm">{error}</p>
                        </div>
                    </div>
                )}
                {code.split('\n').map((line, index) => {
                  const lineNumber = index + 1;
                  const isSelected = selectedLines.includes(lineNumber);
                  return (
                    <div key={lineNumber} className={`flex items-center p-1.5 rounded hover:bg-gray-600/70 ${isSelected ? 'bg-blue-900/60' : ''} transition-colors duration-100`}>
                      <div className="mr-3 select-none cursor-pointer" onClick={() => toggleLineSelection(lineNumber)}>
                        {isSelected ? <CheckSquare size={20} className="text-blue-400" /> : <Square size={20} className="text-gray-500 hover:text-gray-400" />}
                      </div>
                      <span className="text-gray-400 mr-3 w-8 text-right select-none">{lineNumber}.</span>
                      <pre className="whitespace-pre-wrap flex-grow text-gray-100 font-mono text-sm">{line || ' '}</pre>
                    </div>
                  );
                })}
                {code.length === 0 && !error && (
                    <div className="text-center text-gray-400 mt-10">
                        <p className="text-lg">„Ç®„Éá„Ç£„Çø„ÅØÁ©∫„Åß„Åô„ÄÇ</p>
                        <p>„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„Åß„Ç≥„Éº„Éâ„ÇíÁîüÊàê„Åó„ÄÅ„Äå„Ç≥„Éº„Éâ„ÇíÈÅ©Áî®„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    </div>
                )}
              </div>
              <footer className="p-3 bg-gray-900 border-t border-gray-700 flex justify-end">
                <button
                    onClick={() => {
                        if (typeof navigator.clipboard?.writeText === 'function') {
                            navigator.clipboard.writeText(code)
                                .then(() => setChatMessages(prev => [...prev, {sender: 'system', text: '„Ç≥„Éº„Éâ„Åå„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åï„Çå„Åæ„Åó„Åü„ÄÇ'}]))
                                .catch(err => {
                                    console.error('„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å∏„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó:', err);
                                    setChatMessages(prev => [...prev, {sender: 'system', text: '„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å∏„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ'}]);
                                });
                        } else {
                            const textArea = document.createElement("textarea");
                            textArea.value = code;
                            document.body.appendChild(textArea);
                            textArea.focus();
                            textArea.select();
                            try {
                                document.execCommand('copy');
                                setChatMessages(prev => [...prev, {sender: 'system', text: '„Ç≥„Éº„Éâ„Åå„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åï„Çå„Åæ„Åó„Åü„ÄÇ(„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ)'}]);
                            } catch (err) {
                                console.error('„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å∏„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó („Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ):', err);
                                setChatMessages(prev => [...prev, {sender: 'system', text: '„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å∏„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ(„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ)'}]);
                            }
                            document.body.removeChild(textArea);
                        }
                        setMainScreen('chat'); // „Ç≥„Éî„ÉºÂæå„ÄÅ„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„Å´Âàá„ÇäÊõø„Åà„Çã
                    }}
                    className="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out flex items-center"
                    disabled={!code}
                >
                    <Save size={18} className="mr-1.5" /> „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº
                </button>
              </footer>
            </div>
          );


          return (
            <div className="h-screen w-screen font-sans overflow-hidden">
              {mainScreen === 'chat' && renderChatScreen()}
              {mainScreen === 'editor' && renderEditorScreen()}
              {mainScreen === 'sshFileManager' && <SshFileManager onBackToMain={() => setMainScreen('chat')} connectionInfo={connectionInfo} setConnectionInfo={setConnectionInfo} />}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
